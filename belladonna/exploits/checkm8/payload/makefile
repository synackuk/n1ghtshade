CROSS = arm-elf-
AS = $(CROSS)as
OBJCOPY = $(CROSS)objcopy
BIN2C = bin2c
RM = rm
PYTHON = python
ASFLAGS = -mthumb -mlittle-endian --fatal-warnings 
OBJECTS = checkm8_armv7.bin usb_0xA1_2_armv7.bin

%.bin: %.S
	@echo AS -c $(<) -o $(@)
	@$(AS) $(ASFLAGS) -c $(<) -o a.o 
	@$(OBJCOPY) -O binary a.o $(@) 
	@$(RM) a.o

checkm8_payload.h: $(OBJECTS)
	@echo Building $(@)
	@$(PYTHON) build_payload.py
	@$(BIN2C) payload.dfu checkm8_payload.h checkm8_payload

all: checkm8_payload.h

clean:
	@$(RM) -rf *.dfu
	@$(RM) -rf *.bin
	@$(RM) -rf *.h